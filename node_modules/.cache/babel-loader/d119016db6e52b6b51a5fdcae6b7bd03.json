{"ast":null,"code":"const newline = /\\r?\\n/;\nconst onoCall = /\\bono[ @]/;\n/**\n * Is the property lazily computed?\n */\n\nexport function isLazyStack(stackProp) {\n  return Boolean(stackProp && stackProp.configurable && typeof stackProp.get === \"function\");\n}\n/**\n * Is the stack property writable?\n */\n\nexport function isWritableStack(stackProp) {\n  return Boolean( // If there is no stack property, then it's writable, since assigning it will create it\n  !stackProp || stackProp.writable || typeof stackProp.set === \"function\");\n}\n/**\n * Appends the original `Error.stack` property to the new Error's stack.\n */\n\nexport function joinStacks(newError, originalError) {\n  let newStack = popStack(newError.stack);\n  let originalStack = originalError ? originalError.stack : undefined;\n\n  if (newStack && originalStack) {\n    return newStack + \"\\n\\n\" + originalStack;\n  } else {\n    return newStack || originalStack;\n  }\n}\n/**\n * Calls `joinStacks` lazily, when the `Error.stack` property is accessed.\n */\n\nexport function lazyJoinStacks(lazyStack, newError, originalError) {\n  if (originalError) {\n    Object.defineProperty(newError, \"stack\", {\n      get: () => {\n        let newStack = lazyStack.get.apply(newError);\n        return joinStacks({\n          stack: newStack\n        }, originalError);\n      },\n      enumerable: false,\n      configurable: true\n    });\n  } else {\n    lazyPopStack(newError, lazyStack);\n  }\n}\n/**\n * Removes Ono from the stack, so that the stack starts at the original error location\n */\n\nfunction popStack(stack) {\n  if (stack) {\n    let lines = stack.split(newline); // Find the Ono call(s) in the stack, and remove them\n\n    let onoStart;\n\n    for (let i = 0; i < lines.length; i++) {\n      let line = lines[i];\n\n      if (onoCall.test(line)) {\n        if (onoStart === undefined) {\n          // We found the first Ono call in the stack trace.\n          // There may be other subsequent Ono calls as well.\n          onoStart = i;\n        }\n      } else if (onoStart !== undefined) {\n        // We found the first non-Ono call after one or more Ono calls.\n        // So remove the Ono call lines from the stack trace\n        lines.splice(onoStart, i - onoStart);\n        break;\n      }\n    }\n\n    if (lines.length > 0) {\n      return lines.join(\"\\n\");\n    }\n  } // If we get here, then the stack doesn't contain a call to `ono`.\n  // This may be due to minification or some optimization of the JS engine.\n  // So just return the stack as-is.\n\n\n  return stack;\n}\n/**\n * Calls `popStack` lazily, when the `Error.stack` property is accessed.\n */\n\n\nfunction lazyPopStack(error, lazyStack) {\n  Object.defineProperty(error, \"stack\", {\n    get: () => popStack(lazyStack.get.apply(error)),\n    enumerable: false,\n    configurable: true\n  });\n}","map":{"version":3,"mappings":"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","names":["newline","onoCall","isLazyStack","stackProp","Boolean","configurable","get","isWritableStack","writable","set","joinStacks","newError","originalError","newStack","popStack","stack","originalStack","undefined","lazyJoinStacks","lazyStack","Object","defineProperty","apply","enumerable","lazyPopStack","lines","split","onoStart","i","length","line","test","splice","join","error"],"sources":["../src/stack.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}